---
title: Authentication
description: API keys, scopes, and security
---

## API key authentication

All API requests require an API key passed in the `X-API-Key` header:

```bash
curl https://api.answira.com/v1/chatbots \
  -H "X-API-Key: ak_live_YOUR_KEY"
```

### Creating API keys

1. Go to **Settings > API Keys** in the dashboard
2. Click **Create API Key**
3. Select the scopes your integration needs
4. Copy the key -- it is only shown once

### Scopes

API keys use granular scopes to limit access:

| Scope | Description |
|-------|-------------|
| `chatbots:read` | List and view chatbot details |
| `chatbots:write` | Create, update, delete chatbots |
| `training:read` | Check training status, list data sources |
| `training:write` | Upload training data (text, URLs, files) |
| `analytics:read` | View usage stats and analytics |
| `webhooks:read` | View webhook subscriptions and logs |
| `webhooks:write` | Create, delete, and retry webhooks |

### Key format

```
ak_live_abc123def456ghi789...
```

- Prefix `ak_live_` for production keys
- Prefix `ak_test_` for test/sandbox keys

## Public endpoints

Some endpoints don't require an API key -- they are designed for use from the browser widget or client-side apps:

| Endpoint | Purpose |
|----------|---------|
| `POST /v1/sessions` | Start a chat session |
| `POST /v1/messages` | Send a message |
| `POST /v1/messages/stream` | Stream a response (SSE) |
| `GET /v1/sessions/{id}/messages` | Fetch message history |
| `POST /v1/visitors/identify` | Identify a visitor |
| `GET /v1/chatbots/{id}/config` | Get widget config |

<Warning>
  Public endpoints are rate-limited per IP. Use API keys for server-to-server integrations.
</Warning>

## JWT token exchange

For advanced integrations, exchange an API key for a short-lived JWT token:

```bash
curl -X POST https://api.answira.com/v1/auth/api-key/exchange \
  -H "X-API-Key: ak_live_YOUR_KEY"
```

```json Response
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer",
  "expires_in": 1200,
  "user_id": "usr_1234567890abcdef",
  "scopes": ["chatbots:read", "chatbots:write"]
}
```

The JWT expires after 20 minutes. Use it in the `Authorization` header:

```bash
curl https://api.answira.com/v1/chatbots \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."
```

## Visitor identity verification (HMAC)

For the embedded widget, verify visitor identity using HMAC signatures to prevent impersonation:

<CodeGroup>
```javascript Node.js
const crypto = require('crypto');

function generateIdentitySignature(email, apiKey) {
  return crypto
    .createHmac('sha256', apiKey)
    .update(email)
    .digest('hex');
}

const signature = generateIdentitySignature('john@acme.com', 'ak_live_YOUR_KEY');
```

```python Python
import hmac
import hashlib

def generate_identity_signature(email: str, api_key: str) -> str:
    return hmac.new(
        api_key.encode(),
        email.encode(),
        hashlib.sha256
    ).hexdigest()

signature = generate_identity_signature("john@acme.com", "ak_live_YOUR_KEY")
```

```php PHP
$signature = hash_hmac('sha256', 'john@acme.com', 'ak_live_YOUR_KEY');
```
</CodeGroup>

Pass the signature to the widget:

```javascript
BGAIPremiumWidget.init({
  chatbotId: 'YOUR_CHATBOT_ID',
  apiUrl: 'https://api.answira.com',
  visitorEmail: 'john@acme.com',
  visitorName: 'John Doe',
  identitySignature: signature, // Server-generated HMAC
});
```

<Warning>
  Never expose your API key in client-side code. Generate the HMAC signature on your server and pass only the signature to the client.
</Warning>

## Idempotency

Use the `Idempotency-Key` header to prevent duplicate operations when retrying requests:

```bash
curl -X POST https://api.answira.com/v1/messages/stream \
  -H "Content-Type: application/json" \
  -H "Idempotency-Key: msg-unique-001" \
  -d '{"session_id": "ses_123", "message": "Hello"}'
```

If the same key is sent again, the API returns `409 Conflict` instead of processing a duplicate.

## Rate limits

| Endpoint | Limit |
|----------|-------|
| `POST /v1/sessions` | 30/minute |
| `POST /v1/messages/stream` | 60/minute |
| `POST /v1/messages` | 60/minute |
| `POST /v1/chatbots` | 20/minute |
| `POST /v1/.../training/*` | 10/minute |
| `GET /v1/.../training/status` | 60/minute |
| `GET /v1/sessions/*/messages` | 120/minute |
| `GET /v1/chatbots/*` | 120/minute |
| `POST /v1/sessions/*/handoff` | 10/minute |

When rate limited, the API returns `429 Too Many Requests` with a `Retry-After` header.

## Upload limits

| Limit | Value |
|-------|-------|
| Max files per request | 20 |
| Max file size (per file) | 50 MB |
| Max total request size | 500 MB |
| Supported file types | `.csv`, `.txt`, `.pdf`, `.json` |
| Storage quota | Per plan (check your plan) |

Files are validated for content-type integrity (magic bytes must match extension). Uploads exceeding your plan's storage quota are rejected with `403`.

## Error responses

All errors follow a consistent format:

```json
{
  "detail": "Chatbot not found or inactive"
}
```

| Status | Meaning |
|--------|---------|
| `400` | Bad request / validation error |
| `402` | Plan limit reached (upgrade required) |
| `403` | Invalid API key or insufficient scope |
| `404` | Resource not found |
| `409` | Conflict (duplicate idempotency key) |
| `413` | Payload too large (file size or request size exceeded) |
| `429` | Rate limited |
| `500` | Internal server error |
