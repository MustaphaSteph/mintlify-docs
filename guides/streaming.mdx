---
title: Streaming Responses
description: Display AI responses in real-time with Server-Sent Events
---

The streaming endpoint returns AI responses token-by-token using **Server-Sent Events (SSE)**, giving users instant feedback instead of waiting for the full response.

## Quick example

```javascript
const response = await fetch("https://api.answira.com/v1/messages/stream", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    session_id: "ses_123",
    message: "How do I reset my password?",
  }),
});

const reader = response.body.getReader();
const decoder = new TextDecoder();
let fullText = "";

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  for (const line of decoder.decode(value).split("\n")) {
    if (!line.startsWith("data: ")) continue;
    const data = line.slice(6);
    if (data === "[DONE]") return;

    const event = JSON.parse(data);
    if (event.type === "text-delta") {
      fullText += event.delta;
      updateUI(fullText); // Render incrementally
    }
  }
}
```

## Event flow

A typical stream looks like this:

```
message-start > text-start > text-delta (repeated) > text-end > finish > [DONE]
```

For models with thinking capability (Claude, etc.):

```
message-start > reasoning-start > reasoning-delta (repeated) > reasoning-end > text-start > text-delta (repeated) > text-end > finish > [DONE]
```

## Event types

| Event | Payload | Description |
|-------|---------|-------------|
| `message-start` | `{ messageId }` | Stream begins, includes saved message UUID |
| `text-start` | `{ id }` | Response text block begins |
| `text-delta` | `{ id, delta }` | One token of response text |
| `text-end` | `{ id }` | Response text block complete |
| `reasoning-start` | `{ id }` | Model thinking/reasoning begins |
| `reasoning-delta` | `{ id, delta }` | One token of reasoning output |
| `reasoning-end` | `{ id }` | Model thinking complete |
| `finish` | `{ usage }` | Stream complete with `{ input, output }` token counts |
| `heartbeat` | `{}` | Keepalive sent every ~15s during idle periods. Safe to ignore. |
| `error` | `{ errorText, code, retryable, retryAfterMs }` | Error occurred during processing |

## Raw SSE output

```
data: {"type":"message-start","messageId":"d0c5eb0e-f17e-4b86-87a0-06ed126ddf95"}
data: {"type":"text-start","id":"t1"}
data: {"type":"text-delta","id":"t1","delta":"To"}
data: {"type":"text-delta","id":"t1","delta":" reset"}
data: {"type":"text-delta","id":"t1","delta":" your"}
data: {"type":"text-delta","id":"t1","delta":" password"}
data: {"type":"text-delta","id":"t1","delta":","}
data: {"type":"text-delta","id":"t1","delta":" go"}
data: {"type":"text-delta","id":"t1","delta":" to"}
data: {"type":"text-delta","id":"t1","delta":" Settings"}
...
data: {"type":"text-end","id":"t1"}
data: {"type":"finish","usage":{"input":150,"output":42}}
data: [DONE]
```

## Python example

```python
import requests
import json

response = requests.post(
    "https://api.answira.com/v1/messages/stream",
    json={"session_id": "ses_123", "message": "Hello"},
    stream=True,
)

for line in response.iter_lines(decode_unicode=True):
    if not line or not line.startswith("data: "):
        continue
    data = line[6:]
    if data == "[DONE]":
        break
    event = json.loads(data)
    if event["type"] == "text-delta":
        print(event["delta"], end="", flush=True)
    elif event["type"] == "reasoning-delta":
        # Optionally show model thinking
        pass
    elif event["type"] == "finish":
        print(f"\nTokens used: input={event['usage']['input']}, output={event['usage']['output']}")
```

## Error handling

If an error occurs mid-stream, you receive an `error` event with retry information:

```json
{
  "type": "error",
  "errorText": "Rate limit exceeded",
  "code": 429,
  "retryable": true,
  "retryAfterMs": 2000
}
```

When `retryable` is `true`, wait `retryAfterMs` milliseconds and retry the request. Non-retryable errors (invalid session, bot disabled, etc.) should be shown to the user.

```javascript
if (event.type === "error") {
  if (event.retryable) {
    await new Promise(r => setTimeout(r, event.retryAfterMs));
    // Retry the request
  } else {
    showError(event.errorText);
  }
}
```

## Idempotency

Use the `Idempotency-Key` header to prevent duplicate messages if a request is retried:

```bash
curl -N -X POST https://api.answira.com/v1/messages/stream \
  -H "Content-Type: application/json" \
  -H "Idempotency-Key: msg-unique-001" \
  -d '{"session_id": "ses_123", "message": "Hello"}'
```

If the same `Idempotency-Key` is sent again, the API returns `409 Conflict` instead of creating a duplicate message.
